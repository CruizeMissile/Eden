#
# Configuration
#
sudo: required
language: cpp
dist: trusty

branches:
  only:
    - master
    - refactor

notifications:
  email: false

#
# Build Dependencies
#
before_script:
  #
  # Build folder
  #
  - mkdir build
  - cd build

  #
  # Install a recent version of cmake
  #
  - |
    if [[ "${TRAVIS_OS_NAME}" == "linux" ]]; then
      mkdir -p external/cmake
      pushd external/cmake
      wget https://cmake.org/files/v3.8/cmake-3.8.0-Linux-x86_64.sh
      chmod +x cmake-*-Linux-x86_64.sh
      ./cmake-*-Linux-x86_64.sh --exclude-subdir --skip-license
      export PATH="${PWD}/bin:$PATH"
      popd
    else
      if ! brew ls --version cmake &>/dev/null; then brew update; brew install cmake; fi
    fi

#
# Build matrix
#
matrix:
  include:

    #
    # Git check
    #
    - os: linux
      env: TEST="Git Check"
      script:
        - |
          if [[ -n $(git diff --check HEAD^) ]]; then
            echo "You must remove whitespace before submitting a pull request"
            echo ""
            git diff --check HEAD^
            exit -1
          fi

    #
    # Gcc 7.1
    #
    - os: linux
      env: TEST="G++ 7.1"
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-4.0
          packages:
            - gcc-7
            - g++-7
            - xorg-dev
            - libglu1-mesa-dev
      script:
        - cmake -DCMAKE_CXX_COMPILER="g++-7" -DCMAKE_BUILD_TYPE=Release ..
        - cmake --build . --config Release

    #
    # Clang 5.0
    #
    - os: linux
      env: TEST="Clang 4.0"
      compiler: clang
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-4.0
          packages:
            - clang-4.0
            - gcc-7
            - g++-7
            - xorg-dev
            - libglu1-mesa-dev
      script:
        - cmake -DCMAKE_C_COMPILER=clang-4.0 -DCMAKE_CXX_COMPILER=clang++-4.0 -DCMAKE_BUILD_TYPE=Release ..
        - cmake --build . --config Release

    #
    # Clang 5.0
    #
    - os: linux
      env: TEST="Clang 5.0"
      compiler: clang
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-5.0
          packages:
            - clang-5.0
            - gcc-7
            - g++-7
            - xorg-dev
            - libglu1-mesa-dev
      script:
        - cmake -DCMAKE_C_COMPILER=clang-5.0 -DCMAKE_CXX_COMPILER=clang++-5.0 -DCMAKE_BUILD_TYPE=Release ..
        - cmake --build . --config Release

# examples
# https://github.com/Microsoft/GSL/blob/master/.travis.yml
# https://github.com/paulmenzel/brotli/blob/master/.travis.yml
# https://github.com/ainfosec/ci_helloworld/blob/master/.travis.yml
# https://github.com/neovim/neovim/blob/master/.travis.yml
